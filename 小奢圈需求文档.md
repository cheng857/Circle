# 小奢圈需求文档

## 全局

### APP刷新逻辑

| 退出APP路径            | 打开APP后刷新逻辑                                            |
| ---------------------- | ------------------------------------------------------------ |
| 返回桌面/切换应用      | 继续显示原页面和警告框，如果间隔时间超过1分钟请追加事件刷新当前页面 |
| 异常关闭/闪退/进程被杀 | 重新启动APP                                                  |
| 登录状态下被抢登       | 退回登陆页，显示弹窗【该账号已在其他手机登录，如非本人请赶紧登录并修改密码】和确定按钮 |
| 锁屏                   | 继续显示原页面和警告框，如果间隔时间超过1分钟请追加事件刷新当前页面 |

1. iOS系统有后台唤醒自动刷新的方法，时间差由系统决定，仅需后端调用此方法即可；
2. Android可以根据判断此次打开和上次刷新的时间差，超过设定的时间差就自动刷新。

### 权限获取提示

基于用户体验考虑，所有权限仅以保证功能的运行的情况下进行最低频率提示：

| 权限类型 | 提示频率   | 提示位置                           |
| -------- | ---------- | ---------------------------------- |
| 网络     | 仅首次启动 | 首次启动APP                        |
| 定位     | 每小时1次  | 需调用该权限处**（通知弹窗设计）** |
| 通知     | 每日1次    | 进入消息页**（通知弹窗设计）**     |
| 相册     | 每次调用时 | 需调用该权限处                     |
| 相机     | 每次调用时 | 需调用该权限处                     |
| 麦克风   | 每次调用时 | 需调用该权限处                     |
| 通讯录   | 每次调用时 | 需调用该权限处                     |

### 用户经纬度判断

1. 精确定位：定位授权获取
2. IP定位：根据IP地址获取经纬度
3. 历史定位：最后一次定位的经纬度
4. 城市定位：个人信息居住地所维护的城市中心点

### 时间戳

| 模块                  | 判断条件          | 时间戳格式（去零取整） |
| --------------------- | ----------------- | ---------------------- |
| 全局-在线状态         | 在线              | 【在线】               |
|                       | 离线时间＜24H     | 【X小时前在线】        |
|                       | 离线时间＜4天     | 【X天前在线】          |
|                       | 离线时间＜8天     | 【最近在线】           |
|                       | 离线时间≥8天      | 【离线】               |
| 个人中心-访客         | 访问时间＜1min    | 【刚刚来看过你】       |
|                       | 访问时间＜60min   | 【X分钟前来看过你】    |
|                       | 访问时间＜24H     | 【X小时前来看过你】    |
|                       | 访问时间≥24H      | 【X天前来看过你】      |
| 圈子-动态、评论       | 发布时间＜1min    | 【刚刚】               |
|                       | 发布时间＜60min   | 【X分钟前】            |
|                       | 发布时间＜1天     | 【X小时前】            |
|                       | 发布时间＜7天     | 【X天前】              |
|                       | 发布时间＜1年     | 【MM-DD】              |
|                       | 发布时间≥1年      | 【YY-MM-DD】           |
| 圈聊-会话列表、会话页 | 发送时间=当日内   | 【XX:XX】              |
|                       | 发送时间=前一天内 | 【昨天 XX:XX】         |
|                       | 发送时间=本周内   | 【周X XX:XX】          |
|                       | 发送时间=今年内   | 【MM-DD XX:XX】        |
|                       | 发送时间>今年     | 【YY-MM-DD XX:XX】     |
| 钱包-账单明细         | 交易时间          | 【YY-MM-DD XX:XX】     |

### 全局距离格式

| 判断条件     | 距离格式（去零取整）        |
| ------------ | --------------------------- |
| 距离＜1000米 | 【Xm】                      |
| 距离≥1000米  | 【Xkm】（最大值【999+km】） |

### 内容系统审核

1. 审核类型：
   - 真人：人类检测、性别匹配、真人匹配（仅限真人认证用户）
   - 图片/视频：违规检测
   - 文本：敏感词库匹配，置信度标记
   - 人工：后台操作通过/打回，可配置X时间内未审核自动通过

2. 二次审核：所有内容在后台均可进行打回操作

| 模块          | 路径              | 审核类型   | 审核规则  |
| ------------- | ----------------- | ---------- | --------- |
| 注册/资料编辑 | 照片集上传        | 真人、图片 | 🟢同步审核 |
|               | 昵称编辑          | 文本       | 🟢同步审核 |
|               | 个性签名编辑      | 文本       | 🟢同步审核 |
| 真人认证      | 封面头像上传      | 真人、图片 | 🟢同步审核 |
| 人气认证      | 自我介绍上传      | 真人、视频 | 🟡异步审核 |
| 圈聊          | 发送文本消息      | 文本       | 🟡异步审核 |
|               | 发送图片消息      | 图片       | 🟡异步审核 |
|               | 发送视频消息      | 视频       | 🟡异步审核 |
| 圈子          | 发布动态/发布话题 | 人工       | /         |
|               | 动态评论          | 文本       | 🟢同步审核 |

## 登陆/注册

### 登陆/注册

1. 点击引导页开始按钮检测本机手机号
   - 检测到手机号：展示手机号，可直接登录无需验证
   - 未检测到手机号/非+86手机号：跳转【其他手机号登陆】
2. 在登陆按钮处检测该账号是否被限制（后台冻结/封禁），被限制则禁止登陆并Toast【您的账号/设备/IP被限制】
3. 找回密码：
   - 验证手机号：是否未注册、是否被封禁
   - 输入新密码：密码必须符合长度8-32之间且包含英文及数字


### 注册信息完善（按顺序）

1. 性别：设置后无法修改
2. 昵称（选填）：
   - 提供昵称库并随机展示一个
   - 输入限制12个中文字符，输入内容进行系统审核，根据【全局说明-内容系统审核】处理

3. 生日：选择年月日，默认为当天日期减18年，应用内以年龄的形式展示
4. 职业：提供【行业-岗位】维度的职业库供筛选
5. 身高、体重：
   - 单位：cm、kg
   - 默认男性170cm、70kg，女性158cm、59kg

6. 我是什么样的人：后台可编辑标签，需对应Icon
7. 常住城市：
   - 获取用户定位权限，用户未授权则提供城市选择（以及重新授权）
   - 授权后展示用户为中心的1:100比例尺的地图范围，根据UI稿固定展示多个虚拟用户头像

8. 头像上传/真人认证：
   - 上传照片：照片集上传仅可从相册选择，上传后根据【全局说明-内容系统审核】处理
   - 上传完成：男用户-进入首页，女用户-真人认证（可跳过）
   - 真人认证：比对上传照片与本人


## 首页

### 交互引导/用户教程

1. 为达到让用户了解功能作用、交互操作的目的，在用户首次进入相应场景是，以遮盖形式展示用户教程，具体展现形式、交互逻辑参照UI稿
2. 每个ID的账号在一台设备上，每个场景只展示一遍
3. 切换到相应场景时展示对应引导，未展示的场景保留至后续展示
   - 瀑布流首页（根据UI稿遮盖一个假用户）：认证图标、切换展现形式、进入个人主页
   - 单图型首页：滑动操作介绍
   - 人气页：人气板块介绍、人气投票入口
   - 圈子：动态交互、发送动态、话题广场

### 展示用户规则

1. 展示规则：
   - 推荐：根据筛选展示所有用户
   - 活跃：根据筛选展示所有24小时内在线用户
   - 人气：展示所有通过人气认证的用户（此页无筛选）
2. 排序权重、分级：
   - 在线时间：在线>离线时间由近到远
   - 距离：由近到远，每50km一个排序等级
   - 人气认证得分：由高到低，每10%一个排序等级
   - 真人认证：已认证>未认证
   - 会员权益：高级会员>初级会员>非会员
   - 圈TOP人气值/活跃值：由高到低

### 展示字段说明

1. 展示内容、交互形式、展示位置，根据UI定稿
2. 昵称、在线状态、距离
3. 头像：
   - 根据UI稿裁切缩放头像以符合视觉效果
   - 点击跳转用户个人主页
   - 进入人气页需判断用户权益，无权益则模糊头像和昵称并弹出相应弹窗，头像限制跳转
4. 标签：
   - 标签类型：会员，人气认证，真人认证
   - 认证标签权重：人气认证＞真人认证
5. 照片集：展示照片集的缩略图，按照片集图序排列，红包照片模糊处理

### 首页搜索

1. 可搜索用户昵称、ID
2. 后台可配置用户分销权限，搜索该用户做后台绑定记录
3. 具体匹配规则以及展示内容参考原型

### 筛选

1. 可筛选栏目：【推荐】、【活跃】
2. 筛选字段
   - 性别：男性、女性、不限（默认异性）
   - 年龄：18至40+（默认最大范围）
   - 距离：0m至1000km+（默认最大范围）
   - 高级筛选：仅看真人认证用户、仅看人气用户、仅看VIP（默认关闭）
3. 应用存活保持筛选状态

### 人气投票

1. 根据加入投票池时间，倒序展示用户（不重复）
2. 视频水印展示当前浏览用户昵称、ID
3. 每名用户每日最多投票X人（X后台配置）
4. 左滑-忽略，右滑-满意


### 个人主页

1. 关注：交互后标记关注状态，并向对方发送系统消息提醒
2. 私聊：
   - 交互后判断权益，满足权益则跳转会话页
   - 不满足权益可消耗钻石赠送搭讪红包解锁该用户

3. 送礼：
   - 交互后弹出礼物窗口，使用钻石购买礼物，商品表后台可配置
   - 赠送礼物总价值超过私聊解锁金额时，自动解锁私聊
   - 送出礼物后对方收到通知，礼物自动接收并兑换钻石至钱包，兑换比例50%（后台可配置）

4. 资料：
   - 资料列项：注册资料、圈ID、社交帐号、个性签名
   - 未填写的列项参照UI稿展示缺省状态
   - 社交帐号默认【*】隐藏，交互后弹出解锁弹窗，解锁后不再隐藏该列项
5. 照片集：可查看大图，展示真人认证标签，付费解锁的图片展示相应状态
6. 礼物墙：展示收到的礼物类型、数量
7. 圈子：
   - 根据发布时间由新至旧排序
   - 未解锁该用户聊天，则仅可查看最近3条动态，其他动态内容进行模糊处理
8. 用户管理
   - 拉黑：加入黑名单，禁止对方向自己私信、评论，可在设置中移除
   - 举报：选择举报类型，提交聊天证据或图片证据后，后台进行处理

## 圈子

### 展示、交互

1. 分栏筛选：
   - 发现：展示所有用户动态
   - [城市名]：根据当前用户经纬度，展示该城市的异性用户动态
   - 关注：展示关注用户动态
2. 列表排序：时间排序
3. 展示内容：用户基本资料、动态内容、发布时间
4. 圈子搜索：可搜索圈子广场动态内容
5. 动态交互：
   - 点赞（再次点击取消点赞）、评论（限150中文字符）
   - 选单-其他用户发布：关注、举报（无需提交证据，自己的发布无举报）、不感兴趣（在圈子中所有栏目隐藏该条动态）
   - 选单-自己发布：删除（从所有栏目中删除该动态）
6. 评论交互：
   - 长按：回复、复制、举报（无需提交证据，自己的发布无举报）、删除（自己发布的动态下的回复，以及自己的回复才可删除）
   - 隐私评论：设置后仅双方可见（隐私评论的回复自动设置仅双方可见，不可手动设置）


### 发布动态

1. 上传图片/视频（必填）：
   - 图片：限9图
   - 视频：限1个，15S（拍摄控件限制时长，相册选取提供时长剪辑）
2. 填写文本：限150中文字符
3. 加入话题：根据热度展示全部话题，可查看话题列表，提供话题名搜索
4. 创建话题：
   - 填写字段：上传话题封面、填写话题名（限8中文字符）、话题介绍（限150中文字符）
   - 与动态发布时同步提交审核
5. 我在这里：
   - 可关闭位置（默认关闭）
   - 根据首页定位授权逻辑确定经纬度，展示附近地点，其中首行展示当前城市
   - 仅可搜索当前定位城市的具体位置
6. 权限：禁止评论
7. 未发布：未点击提交时退出，可选择保存为【未发布】，填写内容保存至本地，下次进入该页面可继续填写
8. 发布：根据【全局说明-内容系统审核】人工审核处理

### 话题

1. 话题广场
   - 发现页展示入口：根据话题广场排序展示话题，可滑动查看更多
   - 列表排序：优先根据后台配置排序，其次按照【热度-总浏览量】排序
   - 浏览定义：进入动态详情页/点开图片，记为1次浏览，每分钟最多记1次
   - 展示内容：话题封面、话题名、话题介绍、热度、热度标签、关注按钮
   - 搜索：可根据话题名完整包含搜索
2. 关注话题：关注页展示入口
3. 话题详情：根据热度/发布时间排序展示话题内所有动态

### 圈TOP

1. 榜单：

   - 人气榜：女用户参与，根据人气值排名

   - 活跃榜：男用户参与，根据活跃值排名

2. 人气值/活跃值获取方式：（完成任务即获得，后续取消任务不撤销）

   | 任务属性 | 任务         | 次数上限     | 人气值       | 活跃值     |
   | -------- | ------------ | ------------ | ------------ | ---------- |
   | 平台活跃 | 每日登陆活跃 | 登陆/10m/30m | 1/2/3        | 1/2/3      |
   |          | 发布动态     | 不限         | 1            | 1          |
   | 资料完善 | 通过真人认证 | 仅首次       | 20           | 20         |
   |          | 通过人气认证 | 仅首次       | 人气值等值数 | /          |
   | 获得关注 | 获得礼物     | 不限         | 礼物等值数   | /          |
   |          | 动态收到点赞 | 不限         | 1            | /          |
   |          | 收到关注     | 不限         | 1            | /          |
   | 积极互动 | 解锁私聊     | 不限         | /            | 2          |
   |          | 解锁社交账号 | 不限         | /            | 2          |
   |          | 送出礼物     | 不限         | /            | 礼物等值数 |

3. 展示用户：

   - 发现页展示入口：展示人气榜、活跃榜前三用户
   - 列表展示：排名前50的用户

4. 奖励/特权：前三名展示专属头像框（根据名次变动而转移）

5. 每日0点更新数据，同时结算奖励

## 圈聊

### 会话列表

1. 通知中心：收纳消息类型
   - 圈子互动：礼物、关注、点赞、评论
   - 系统通知：认证消息、迎新消息、后台自定义消息
2. 客服：会话页隐藏聊天管理、送礼
3. 网络异常：检测到网络状态异常时，展示相应状态图标
4. 导航栏、列项-消息红点：
   - 用户未读消息：显示未读消息数（1至99+）
   - 通知中心/客服消息/免打扰消息：仅显示红点

5. 列项交互：
   - 免打扰：消息列项展示免打扰图标，此时收到未读消息只显示小红点
   - 标为未读/已读：将最新一条消息标记为未读状态/将所有未读消息标记为已读状态
   - 删除：会话列表删除该列项，不影响本地消息记录
6. 消息标签梳理：[图片] ，[视频] ，[语音] ，[位置]门牌号
7. 会话列表高亮消息体：
   - 【搭讪红包】搭讪语句
   - 【礼物】礼物名：收到礼物消息时
   - 【草稿】草稿内容：在输入框内输入后未发送时
   - 【发送失败】：发送消息失败时
8. 搭讪红包消息：收到用户搭讪解锁消息时，展示特殊提醒
9. 通知授权：用户未授权通知权限，在会话列表顶部展示常驻横幅提示（直到开启授权后消失）

### 会话页

1. 用户发送的消息内容，根据【全局说明-内容系统审核】处理
2. 会话页交互及展示内容参考原型

## 个人中心

### 平台身份权益/功能限制	

| 权益类型     | 普通用户       | 真人认证女用户  | 人气认证女用户  | 白银会员 | 黄金会员 |
| ------------ | -------------- | --------------- | --------------- | -------- | -------- |
| 解锁圈聊     | 男用户搭讪红包 | 每日3人（单向） | 每日5人（单向） | 每日10人 | 每日20人 |
| 发布动态     | /              | 每日3条         | 每日5条         | 无限制   | 无限制   |
| 解锁评论     | /              | 每日5条         | 每日10条        | 无限制   | 无限制   |
| 专属勋章     | /              | 认证标识        | 人气徽章        | 会员勋章 | 会员勋章 |
| 优先推荐     | /              | 支持            | 支持            | 支持     | 支持     |
| 人气板块     | /              | /               | 支持            | 支持     | 支持     |
| 红包照片     | /              | /               | 支持            | /        | /        |
| 高级筛选     | /              | /               | /               | 支持     | 支持     |
| 专属客服     | /              | /               | /               | 支持     | 支持     |
| 解锁关注限制 | 10人           | 10人            | 10人            | 无限制   | 无限制   |
| 解锁微信     | 单次解锁       | 单次解锁        | 单次解锁        | 每日5人  | 每日10人 |
| 访客查看     | /              | /               | /               | /        | 支持     |
| 首页推荐隐藏 | /              | /               | /               | /        | 支持     |
| 隐藏地理位置 | /              | /               | /               | /        | 支持     |
| 隐身模式     | /              | /               | /               | /        | 支持     |
| 足迹隐藏     | /              | /               | /               | /        | 支持     |
| 身份保密     | /              | /               | /               | /        | 支持     |

### 个人资料编辑

1. 照片集：
   - 共六张照片位，首张做为封面头像
   - 点击空位-上传，点击已上传的照片-重新上传、删除
   - 可长按拖动排序，删除照片从后向前顶替，封面头像不可删除
   - 上传照片进行系统审核，真人认证用户额外进行真人比对
   - 审核未通过，照片位仍替换，在其上进行标注（审核未通过>照片非本人）
   - 保存时进行检测，封面头像审核未通过则弹窗-修改/恢复，其他照片审核未通过则不生效
2. 红包照片设置：
   - 仅通过人气认证的女性用户可设置，否则弹出认证提示；男性不展示设置入口
   - 可设置照片类型：通过审核的非封面头像照片
   - 可设置金额：提供固定数值的钻石（后台可配置），其他用户查看需要支付才可查看该照片
   - 设置后不可作为封面头像
3. 个人资料编辑：
   - 注册资料修改：填写规则同注册流程
   - 社交账号：限制6-20位英文/数字/符号
   - 个性签名：限制150中文字符，输入内容进行系统审核，根据【全局说明-内容系统审核】处理
4. 提供个人主页实时预览
5. 用户未保存退出时，弹窗提示-保存/不保存

### 会员中心

1. 会员分层：白银会员，黄金会员
2. 开通：（金额、周期、优惠比例后台可配置）
   - 开通货币：钻石，三方支付
   - 开通方式：直充、续费（续费有额外优惠）
   - 开通周期：月-31天/季-92天/年-366天（单次开通时间越长，优惠更多）
   - 直充/续费的时间，截止时间为次日的0点（例如：开通日期2023/7/1-03:00:00，充值1个月，截止时间为2023/8/2-00:00:00）

### 认证中心

1. 真人认证：
   - 用户上传照片：系统真人审核（审核未通过则提示用户重新上传照片）
   - 人脸认证比对：调用三方人脸认证（审核未通过则提示用户重新上传照片）
   - 比对通过：上传照片替换照片集封面，其他照片自动真人审核（审核未通过则下架并标记提示）
2. 人气认证（仅女用户）：
   - 完成真人认证用户才可进行人气认证
   - 用户上传自我介绍视频：系统根据真人认证照片比对并审核
   - 审核通过进入人气投票池：投票时间X天（X后台配置），满意人数/总投票人数>70%视为投票通过
   - 投票通过进行后台审核：后台通过视为认证通过
   - 系统审核、投票未通过、后台审核未通过：结束认证并通知用户

### 钱包

1. 充值：
   - 充值方式：三方支付
   - 充值比例：¥1=10钻石（后台可配置）
   - 商品表（后台可配置）
2. 明细：
   - 字段：交易来源、交易内容、交易金额、交易时间
   - 分栏：充值、收益（收礼）、消费（送礼、开通会员、解锁单次权益）
3. 提现：初版无提现

### 关注、粉丝、来访

1. 关注、粉丝：提供昵称、ID搜索
2. 来访：
   - 来访定义：查看过我的个人主页
   - 来访时间：最后一次进入我的个人主页的时间
   - 无权益用户视角，头像、昵称模糊处理


### 我的动态

仅展示个人动态由新至旧列表展示

### 设置

1. 账号安全
   - 手机换绑：验证两个手机号，检测新手机号是否绑定其他账号，以及是否受到后台限制
   - 密码修改：密码必须符合长度8-32之间且包含英文及数字
   - 账号注销：填写注销原因、确认注销须知后，进行手机号验证，验证后进行注销
     1. 后台解绑手机
     2. 用户退回登录页，Tost提示【注销成功】
     3. 该手机、邮箱30天内不能注册/绑定，否则Toast提示【该账号30日内不能注册】
     4. 清空余额
     5. 清空本地聊天记录
     6. 取消所有关注
     7. 删除所有发布的动态
     8. 清空资料，无法搜索该用户
2. 隐私设置
   - 同性用户查看主页：关闭后，同性用户查看将弹窗屏蔽
   - 同性用户私聊：关闭后，同性用户查看将弹窗屏蔽
   - 隐藏社交账号：开启后，他人可以解锁查看，否则不展示社交账号
   - 首页推荐隐藏：开启后，将不再推荐至首页任何栏目
   - 隐藏地理位置：开启后，与其他用户的距离将不再展示，个人信息-城市展示为【保密】，同时该用户的推荐逻辑中距离为999+km
   - 隐藏足迹：开启后，查看其他用户个人主页将不再留下访问记录
   - 隐身模式：开启后，在线状态变更为【离线】
   - 身份保密：开启后，该用户的照片集变为一张特定图片，同时昵称修改为【神秘人】
3. 消息通知
   - 通知隐藏消息详情
   - 系统消息通知关闭
   - 互动消息通知关闭
4. 黑名单：支持移除操作
5. 关于我们
6. 缓存清理
7. 登出

## 后台

## 埋点

**埋点：设备类型、ID、IP、模块、位置、时间、动作**